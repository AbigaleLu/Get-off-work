<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小组件倒计时</title>
    <meta name="color-scheme" content="light dark">
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --ring: rgba(0, 0, 0, 0.06);
            --text-1: #222;
            --text-2: #555;
            --brand: #007aff;
            --card-bg: rgba(255, 255, 255, 0.9);
        }
        @media (prefers-color-scheme: dark) {
            :root {
                --ring: rgba(255, 255, 255, 0.12);
                --text-1: #f5f5f7;
                --text-2: #d0d3d7;
                --card-bg: rgba(20, 20, 20, 0.7);
            }
            body {
                background: radial-gradient(1200px 600px at 10% 0%, rgba(20, 30, 60, 0.8) 0, transparent 60%),
                            radial-gradient(1200px 600px at 90% 100%, rgba(30, 20, 10, 0.8) 0, transparent 60%),
                            linear-gradient(180deg, #1c1c1e, #18191d);
            }
            .offwork-bg {
                filter: brightness(0.8) saturate(1.2);
            }
        }
        * {
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            min-height: 100vh;
            margin: 0;
            padding: 24px;
            background: radial-gradient(1200px 600px at 10% 0%, #f1f5ff 0, transparent 60%),
                        radial-gradient(1200px 600px at 90% 100%, #fff7ed 0, transparent 60%),
                        linear-gradient(180deg, #fafafa, #f6f7fb);
            transition: background-color 0.5s;
        }
        .page-wrap {
            max-width: 1100px;
            margin: 0 auto;
            display: grid;
            gap: 24px;
            grid-template-columns: 1fr;
        }
        @media (min-width: 980px) {
            .page-wrap {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* ======= 通用卡片骨架（外层） ======= */
        .card-shell {
            position: relative;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 14px 40px rgba(0, 0, 0, .10);
            border: 1px solid var(--ring);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            background: var(--card-bg);
        }
        .card-inner {
            position: relative;
            padding: 24px; /* Reduced padding */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px; /* Reduced gap */
            min-height: 280px; /* Reduced min-height */
            z-index: 1;
        }
        .card-title {
            margin: 0;
            font-weight: 700;
            letter-spacing: .02em;
            color: var(--text-1);
            text-shadow: 0 1px 0 rgba(255, 255, 255, .15);
            font-size: 1.5rem; /* Reduced font size */
        }
        .subtle {
            color: var(--text-2);
            font-size: .8rem; /* Reduced font size */
            min-height: 1.25em;
            text-align: center;
        }

        /* ======= 放假卡：保留原生渐变动画（迁移到卡背景） ======= */
        .holiday-bg {
            position: absolute;
            inset: 0;
            z-index: 0;
            opacity: 1;
            background: linear-gradient(135deg, #d3c4d7, #c6b2c2, #e5d1a8, #f4c284);
            background-size: 400% 400%;
            animation: holidayGradient 15s ease infinite;
        }
        @keyframes holidayGradient {
            0% {
                background-position: 0% 50%
            }
            50% {
                background-position: 100% 50%
            }
            100% {
                background-position: 0% 50%
            }
        }

        /* ======= 下班卡：保留原生渐变动画（迁移到卡背景） ======= */
        .offwork-bg {
            position: absolute;
            inset: 0;
            z-index: 0;
            opacity: 1;
            background: linear-gradient(135deg, #fce4ec, #e8f5e9, #e1f5fe, #fff9c4);
            background-size: 400% 400%;
            animation: offworkGradient 15s ease infinite;
        }
        @keyframes offworkGradient {
            0% {
                background-position: 0% 50%
            }
            50% {
                background-position: 100% 50%
            }
            100% {
                background-position: 0% 50%
            }
        }

        /* ======= 放假卡内部控件（延续你原来的细节） ======= */
        .field {
            width: 100%;
            display: grid;
            gap: 8px; /* Reduced gap */
        }
        .holiday-input {
            width: 100%;
            padding: 10px 12px; /* Reduced padding */
            border: 1px solid #cfcfd3;
            border-radius: 10px; /* Reduced border-radius */
            font-size: .9rem; /* Reduced font size */
            color: var(--text-2);
            background: rgba(255, 255, 255, 0.9);
            appearance: none;
            outline: none;
            transition: border-color .2s ease, box-shadow .2s ease;
        }
        .holiday-input:focus {
            border-color: var(--brand);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, .12); /* Reduced shadow */
            color: var(--text-1);
        }
        .primary-btn {
            width: 100%;
            padding: 12px 14px; /* Reduced padding */
            border: none;
            border-radius: 10px; /* Reduced border-radius */
            background: var(--brand);
            color: #fff;
            font-weight: 650;
            font-size: .9rem; /* Reduced font size */
            cursor: pointer;
            transition: transform .06s ease, background-color .2s ease;
        }
        .primary-btn:hover {
            background: #005ecb;
        }
        .primary-btn:active {
            transform: translateY(1px);
        }

        .bigline {
            font-size: 1rem; /* Reduced font size */
            color: var(--text-1);
            font-weight: 600;
        }
        .days-large {
            font-size: 2.5rem; /* Reduced font size */
            font-weight: 800;
            color: var(--text-1);
            margin: 2px 0; /* Reduced margin */
        }

        .progress-wrap {
            width: 100%;
            display: grid;
            gap: 6px; /* Reduced gap */
        }
        .progress-bar {
            height: 8px; /* Reduced height */
            width: 100%;
            background: rgba(0, 0, 0, 0.08);
            border-radius: 999px;
            overflow: hidden;
        }
        .progress-bar>div {
            height: 100%;
            width: 0%;
            background: var(--brand);
            transition: width .6s ease;
        }
        .progress-labels {
            display: flex;
            justify-content: space-between;
            color: var(--text-2);
            font-size: .75rem; /* Reduced font size */
        }

        .hidden-el {
            opacity: 0;
            position: absolute;
            pointer-events: none;
        }
        .visible-el {
            opacity: 1;
            position: relative;
            pointer-events: auto;
        }

        /* ======= 下班卡内部（沿用 Tailwind + 轻微补充） ======= */
        .firework-container {
            position: absolute;
            inset: 0;
            z-index: 20;
            pointer-events: none;
            overflow: hidden;
        }
        .firework-emoji {
            position: absolute;
            font-size: 2.5rem; /* Reduced font size */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: single-firework 2.5s ease-out forwards;
        }
        @keyframes single-firework {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
                opacity: 1;
            }
            25% {
                transform: translate(-50%, -50%) scale(1.5) rotate(30deg);
                opacity: 1;
            }
            75% {
                transform: translate(-50%, -50%) scale(1.5) rotate(-60deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1.5) rotate(30deg);
                opacity: 0;
            }
        }

        /* 小标题条，增强视觉区分 */
        .section-tag {
            position: absolute;
            top: 8px; /* Adjusted position */
            left: 10px; /* Adjusted position */
            z-index: 2;
            font-size: .65rem; /* Reduced font size */
            font-weight: 700;
            letter-spacing: .06em; /* Reduced letter spacing */
            color: rgba(0, 0, 0, .65);
            background: rgba(255, 255, 255, .75);
            padding: 4px 8px; /* Reduced padding */
            border-radius: 999px;
            border: 1px solid var(--ring);
            backdrop-filter: blur(8px);
        }
        @media (prefers-color-scheme: dark) {
            .section-tag {
                color: #e5e7eb;
                background: rgba(20, 20, 20, .55);
            }
        }

        /* Message box styling */
        .message-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 0.3s ease;
        }

        .message-modal-content {
            background: var(--card-bg);
            padding: 20px; /* Reduced padding */
            border-radius: 10px; /* Reduced border-radius */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--ring);
            max-width: 280px; /* Reduced max-width */
            width: 90%;
            text-align: center;
        }

        .message-modal-content h3 {
            font-size: 1.1rem; /* Reduced font size */
            font-weight: 600;
            color: var(--text-1);
            margin-bottom: 10px; /* Reduced margin */
        }

        .message-modal-content p {
            color: var(--text-2);
            margin-bottom: 16px; /* Reduced margin */
            font-size: 0.9rem;
        }

        .message-modal-content button {
            background: var(--brand);
            color: #fff;
            padding: 8px 16px; /* Reduced padding */
            border-radius: 6px; /* Reduced border-radius */
            font-weight: 600;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }

        .message-modal-content button:hover {
            background: #005ecb;
        }
        
        /* Specific adjustments for smaller screens */
        @media (max-width: 979px) {
            .card-inner {
                padding: 16px;
                min-height: 240px;
            }
            .card-title {
                font-size: 1.3rem;
            }
            .days-large {
                font-size: 2rem;
            }
        }
        
        /* Off-work specific styles for small widgets */
        #offwork-content-display {
            font-size: 0.9rem;
        }
        #offwork-msg {
            font-size: 1rem;
            font-weight: 500;
        }
        #offwork-row {
            font-size: 2.5rem;
            line-height: 1.2;
        }
        @media (min-width: 980px) {
            #offwork-row {
                font-size: 3rem;
            }
        }
        
    </style>
</head>
<body>
    <main class="page-wrap">
        <!-- ===================== 放假倒计时卡 ===================== -->
        <section class="card-shell" aria-labelledby="holiday-title">
            <div class="holiday-bg" aria-hidden="true"></div>

            <div class="card-inner" id="holiday-card">
                <h1 id="holiday-title" class="card-title">放假倒计时</h1>
                <div id="holiday-selected-date-label" class="subtle"></div>

                <!-- 输入界面 -->
                <div id="holiday-input-container" class="visible-el" aria-hidden="false" style="width:100%;display:flex;flex-direction:column;align-items:center;gap:12px;">
                    <div class="field">
                        <input type="date" id="holiday-date-picker" class="holiday-input" aria-label="选择放假日期">
                    </div>
                    <button id="holiday-calc-btn" class="primary-btn" aria-describedby="holiday-selected-date-label">确认</button>
                </div>

                <!-- 结果界面 -->
                <div id="holiday-result-container" class="hidden-el" aria-hidden="true" style="width:100%;display:flex;flex-direction:column;align-items:center;gap:12px;">
                    <div id="holiday-countdown-text" class="bigline" aria-live="polite"></div>
                    <div id="holiday-countdown-days" class="days-large" aria-live="polite"></div>

                    <div class="progress-wrap" id="holiday-progress-wrap" hidden>
                        <div class="progress-bar">
                            <div id="holiday-progress-inner"></div>
                        </div>
                        <div class="progress-labels">
                            <span>今天</span>
                            <span id="holiday-progress-end">目标日</span>
                        </div>
                    </div>
                </div>
            </div>
            <div id="holiday-live-region" aria-live="polite" aria-atomic="true" style="position:absolute;width:1px;height:1px;margin:-1px;border:0;padding:0;clip:rect(0 0 0 0);overflow:hidden;white-space:nowrap;"></div>
        </section>

        <!-- ===================== 下班倒计时卡 ===================== -->
        <section class="card-shell" aria-labelledby="offwork-title">
            <div class="offwork-bg" aria-hidden="true"></div>
       
            <div class="card-inner relative" id="offwork-card">
                <h1 id="offwork-title" class="card-title">下班倒计时</h1>
                <div id="offwork-content-display" class="relative z-10 text-center">
                    <p id="offwork-msg" class="text-lg font-medium text-gray-700/90 dark:text-gray-200/90">距离下班还有</p>
                    <h2 id="offwork-row" class="font-extrabold tracking-tight leading-tight mt-1 text-gray-800 dark:text-gray-100">
                        <span id="offwork-hh">--</span><span class="mx-1">:</span>
                        <span id="offwork-mm">--</span><span class="mx-1">:</span>
                        <span id="offwork-ss">--</span>
                    </h2>
                </div>
                <div id="offwork-fireworks" class="firework-container hidden"></div>
                <button id="offwork-fire-btn" class="hidden mt-3 px-5 py-2 bg-gradient-to-r from-pink-300 to-purple-400 text-white font-semibold rounded-full shadow-lg hover:from-pink-400 hover:to-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-300 focus:ring-opacity-50 transition-transform transform hover:scale-105">
                    立即放烟花
                </button>
            </div>
        </section>
    </main>

    <!-- Custom message box modal -->
    <div id="message-modal" class="message-modal hidden">
        <div class="message-modal-content">
            <h3 id="message-modal-title">提示</h3>
            <p id="message-modal-text">这是一个消息</p>
            <button id="message-modal-ok">确定</button>
        </div>
    </div>

    <script>
        // Custom function to show a message box instead of alert()
        function showMessage(text, title = '提示') {
            const modal = document.getElementById('message-modal');
            document.getElementById('message-modal-title').textContent = title;
            document.getElementById('message-modal-text').textContent = text;
            modal.classList.remove('hidden');
            document.getElementById('message-modal-ok').onclick = () => {
                modal.classList.add('hidden');
            };
        }

        // =============== 工具函数（共享） ===============
        const pad2 = n => String(n).padStart(2, '0');
        const toLocalMidnight = d => {
            const x = new Date(d);
            x.setHours(0, 0, 0, 0);
            return x;
        };
        const fmtDateFull = d => new Intl.DateTimeFormat('zh-CN', {
            dateStyle: 'full'
        }).format(d);
        const fromYMD = s => {
            const m = /^(\d{4})-(\d{2})-(\d{2})$/.exec(s);
            if (!m) return null;
            const yy = parseInt(m[1], 10),
                mm = parseInt(m[2], 10) - 1,
                dd = parseInt(m[3], 10);
            return new Date(yy, mm, dd, 0, 0, 0, 0);
        };
        const ymd = d => `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;

        // =============== 放假倒计时（命名空间：holiday-） ===============
        (function() {
            const root = document.getElementById('holiday-card');
            const datePicker = document.getElementById('holiday-date-picker');
            const calcBtn = document.getElementById('holiday-calc-btn');
            const inputContainer = document.getElementById('holiday-input-container');
            const resultContainer = document.getElementById('holiday-result-container');
            const label = document.getElementById('holiday-selected-date-label');
            const text = document.getElementById('holiday-countdown-text');
            const days = document.getElementById('holiday-countdown-days');
            const progressWrap = document.getElementById('holiday-progress-wrap');
            const progressInner = document.getElementById('holiday-progress-inner');
            const progressEnd = document.getElementById('holiday-progress-end');
            const live = document.getElementById('holiday-live-region');

            const today = toLocalMidnight(new Date());
            datePicker.min = ymd(today);
            datePicker.value = ymd(today); // Default to today's date
            let tickTimer = null;

            function showResult(targetMidnight) {
                inputContainer.classList.replace('visible-el', 'hidden-el');
                inputContainer.setAttribute('aria-hidden', 'true');
                resultContainer.classList.replace('hidden-el', 'visible-el');
                resultContainer.setAttribute('aria-hidden', 'false');

                label.textContent = `目标日：${fmtDateFull(targetMidnight)}`;
                progressEnd.textContent = new Intl.DateTimeFormat('zh-CN', {
                    month: 'long',
                    day: 'numeric'
                }).format(targetMidnight);

                if (tickTimer) clearInterval(tickTimer);
                const start = toLocalMidnight(new Date());
                const totalMs = targetMidnight - start;

                const tick = () => {
                    const now = new Date();
                    const msLeft = targetMidnight - now;
                    const daysLeft = Math.ceil((toLocalMidnight(targetMidnight) - toLocalMidnight(now)) / 86400000);

                    if (daysLeft <= 0) {
                        text.textContent = '今天就是放假啦！🎉';
                        days.textContent = '0';
                        progressWrap.hidden = true;
                        live.textContent = '今天放假';
                        clearInterval(tickTimer);
                        return;
                    }
                    text.textContent = '距离放假还有';
                    days.textContent = String(daysLeft);

                    if (totalMs > 0) {
                        const done = Math.min(1, Math.max(0, 1 - (msLeft / totalMs)));
                        progressWrap.hidden = false;
                        progressInner.style.width = (done * 100).toFixed(2) + '%';
                    } else {
                        progressWrap.hidden = true;
                    }
                    live.textContent = `还有 ${daysLeft} 天`;
                };
                tick();
                tickTimer = setInterval(tick, 1000);
            }

            calcBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                if (!datePicker.value) {
                    showMessage('请先选择一个日期哦！');
                    return;
                }
                const sel = fromYMD(datePicker.value);
                if (!sel) {
                    showMessage('日期格式无效');
                    return;
                }
                const selMid = toLocalMidnight(sel);
                if (selMid < today) {
                    showMessage('这个日期已经过去了，请选择一个未来的日期。');
                    return;
                }
                
                // Show result locally
                showResult(selMid);
            });

            // Click card to switch back to input
            root.addEventListener('click', () => {
                if (resultContainer.classList.contains('visible-el')) {
                    if (tickTimer) clearInterval(tickTimer);
                    resultContainer.classList.replace('visible-el', 'hidden-el');
                    resultContainer.setAttribute('aria-hidden', 'true');
                    inputContainer.classList.replace('hidden-el', 'visible-el');
                    inputContainer.setAttribute('aria-hidden', 'false');
                    datePicker.focus({
                        preventScroll: true
                    });
                }
            });
        })();

        // =============== 下班倒计时（命名空间：offwork-） ===============
        (function() {
            // 可配置项
            const WORK_END_HOUR = 17; // 24 小时制
            const WORKDAYS = [1, 2, 3, 4, 5]; // 周一~周五

            // DOM
            const msg = document.getElementById('offwork-msg');
            const row = document.getElementById('offwork-row');
            const elH = document.getElementById('offwork-hh');
            const elM = document.getElementById('offwork-mm');
            const elS = document.getElementById('offwork-ss');
            const fireworks = document.getElementById('offwork-fireworks');
            const fireBtn = document.getElementById('offwork-fire-btn');
            const card = document.getElementById('offwork-card');

            let animationTriggered = false;

            const inWorkCountdownWindow = (now = new Date()) => {
                const dayOK = WORKDAYS.includes(now.getDay());
                const beforeEnd = now.getHours() < WORK_END_HOUR || (now.getHours() === WORK_END_HOUR && now.getMinutes() === 0 && now.getSeconds() === 0);
                return dayOK && beforeEnd;
            };

            function launchFireworks() {
                if (animationTriggered) return;
                animationTriggered = true;
                fireworks.classList.remove('hidden');
                const particle = document.createElement('span');
                particle.className = 'firework-emoji';
                particle.textContent = '🎉';
                fireworks.appendChild(particle);
                setTimeout(() => {
                    if (fireworks && particle) {
                        fireworks.removeChild(particle);
                        fireworks.classList.add('hidden');
                        animationTriggered = false;
                    }
                }, 2500);
            }

            function updateCountdown() {
                const now = new Date();

                if (inWorkCountdownWindow(now)) {
                    row.classList.remove('hidden');

                    const target = new Date(now.getFullYear(), now.getMonth(), now.getDate(), WORK_END_HOUR, 0, 0);
                    const diffMs = Math.max(0, target - now);

                    if (diffMs === 0) {
                        msg.textContent = '祝你下班快乐!';
                        elH.textContent = elM.textContent = elS.textContent = '00';
                        card.classList.add('bg-pink-100');
                        launchFireworks();
                    } else {
                        const totalSec = Math.floor(diffMs / 1000);
                        const h = Math.floor(totalSec / 3600);
                        const m = Math.floor((totalSec % 3600) / 60);
                        const s = totalSec % 60;
                        elH.textContent = pad2(h);
                        elM.textContent = pad2(m);
                        elS.textContent = pad2(s);
                        msg.textContent = '距离下班还有';
                        card.classList.remove('bg-pink-100');
                    }
                } else {
                    row.classList.add('hidden'); // 彻底隐藏倒计时行，避免冒号残影
                    msg.textContent = '要好好生活🥰';
                    card.classList.remove('bg-pink-100');
                }
            }

            window.onload = function() {
                // Start the off-work countdown
                updateCountdown();
                setInterval(updateCountdown, 1000);
                fireBtn.addEventListener('click', launchFireworks);
            };
        })();
    </script>
</body>
</html>
